<ng-container *ngIf='session && user'>
  <button
    mat-fab extended color="primary"
    *ngIf='!session.started && session.host === user.id' (click)="startSession()"
  >
    <mat-icon>play_arrow</mat-icon>
    Start Game
  </button>

  <ng-container *ngIf='session.started'>
    <div>
      <button mat-button (click)="accordion.openAll()">Expand All</button>
      <button mat-button (click)="accordion.closeAll()">Collapse All</button>
      <ui-card>
        phase: {{session.phase === 0 ? 'Growing' : 'acting' }}
        food: {{session.eat}}
        current Player: {{session.players[session.currentPlayer].name}}
        host: {{session.host}}
      </ui-card>
    </div>
    <mat-accordion #accordion=matAccordion multi>
      <mat-expansion-panel *ngFor='let player of players' [expanded]='true'>
        <mat-expansion-panel-header>
          <mat-panel-title>
            {{ player.name }}
          </mat-panel-title>

          <mat-panel-description>
            description
          </mat-panel-description>
        </mat-expansion-panel-header>


        <ui-card>
          player cards
        </ui-card>
      </mat-expansion-panel>
    </mat-accordion>

    <div class='mt-3'>
      <ui-card>
        <div
          #myDeck="cdkDropList"
          cdkDropList
          class='list flex'
          cdkDropListOrientation="horizontal"
          [cdkDropListSortPredicate]='sortMyAnimals'
          [cdkDropListData]="myPlayer.animals"
          (cdkDropListDropped)="animalDropped($event)"
        >
          <div
            *ngFor="let card of myPlayer.animals"
            class='card flex-auto mr-3 last:mr-0'
            cdkDrag
            [cdkDragData]='card'
          >
            <ui-card>
              Animal
            </ui-card>
          </div>
        </div>
      </ui-card>
    </div>

    <mat-selection-list
      [multiple]="false"
      #list=matSelectionList
      (selectionChange)='selectProperty($event);'
    >
      <div
        cdkDropList
        [cdkDropListData]="myPlayer.hand"
        class='list flex mt-3'
        cdkDropListOrientation="horizontal"
        [cdkDropListDisabled]='session.currentPlayer !== myPlayer.id'
        (cdkDropListDropped)="handDrop($event)"
        [cdkDropListConnectedTo]="[myDeck]"
      >
        <div
          *ngFor="let card of myPlayer.hand;"
          class='card flex-auto mr-3 last:mr-0'
          (cdkDragStarted)='list.deselectAll();selectedProperty = ""'
          cdkDrag
          [cdkDragData]='card'
        >
          <div class='bg-lime-50 border-green-900 border-8 rounded-3xl overflow-hidden' >
            <mat-card-header class='border-green-900 border-b-2'>
              <div class='text-green-900'>
                <mat-card-title>Animal</mat-card-title>
              </div>
            </mat-card-header>

            <mat-list-option [value]='card.type1' [ngClass]='{
        "bg-amber-300": card.type1 === cardTypes.FAT_TISSUE,
        "bg-red-600": card.type1 === cardTypes.CARNIVOROUS,
        "bg-blue-600": card.type1 === cardTypes.SWIMMING,
        "bg-violet-600": card.type1 === cardTypes.PARASITE
        }'>

              <span [ngClass]='{
        "text-white": card.type1 === cardTypes.CARNIVOROUS
        }'>{{propertyMap[card.type1].title}}</span>
            </mat-list-option>

            <mat-list-option *ngIf='card.type2' [value]='card.type2' [ngClass]='{
        "bg-amber-300": card.type2 === cardTypes.FAT_TISSUE,
        "bg-red-600 text-white": card.type2 === cardTypes.CARNIVOROUS,
        "bg-blue-600": card.type2 === cardTypes.SWIMMING,
        "bg-violet-600": card.type2 === cardTypes.PARASITE
        }'>
             <span [ngClass]='{"text-white": card.type2 === cardTypes.CARNIVOROUS}'>
               {{propertyMap[card.type2].title}}
             </span>
            </mat-list-option>
          </div>
        </div>
      </div>
    </mat-selection-list>

    <div class='flex justify-end mt-3'>
      <button
        mat-fab extended color="primary"
        *ngIf='session.currentPlayer === myPlayer.id' (click)="endPhase()"
      >
        <mat-icon>next_plan</mat-icon>
        End phase
      </button>
    </div>

  </ng-container>
</ng-container>
